generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                         String                @id @default(cuid())
  email                      String?               @unique
  phone                      String?               @unique
  firstName                  String
  lastName                   String
  username                   String?               @unique
  userType                   String                @default("REFEREE")
  password                   String?
  profilePicture             String?
  backgroundImage            String?
  bio                        String?
  linkedinUrl                String?
  twitterUrl                 String?
  facebookUrl                String?
  instagramUrl               String?
  websiteUrl                 String?
  skills                     String?
  companyName                String?
  achievement                String?
  achievementMethod          String?
  statementSummary           String?
  statementSummary3rdPerson  String?
  introRequest               String?
  cardPageBgColor            String?
  cardBoxBgColor             String?
  cardTextColor              String?
  cardBgImage                String?
  magicLinkToken             String?               @unique
  magicLinkExpiry            DateTime?
  createdAt                  DateTime              @default(now())
  updatedAt                  DateTime              @updatedAt
  magicLinkRedirect          String?
  tiktokUrl                  String?
  cardFooterBgColor          String?
  cardFooterTextColor        String?
  cardProfileBorderColor     String?
  cardButtonABgColor         String?
  cardButtonATextColor       String?
  cardButtonBBgColor         String?
  cardButtonBTextColor       String?
  careerHistory              CareerHistory[]
  connectedTo                Connection[]          @relation("ConnectedToUser")
  connections                Connection[]          @relation("UserConnections")
  connectionRequestsSent     ConnectionRequest[]   @relation("ConnectionRequestsSent")
  connectionRequestsReceived ConnectionRequest[]   @relation("ConnectionRequestsReceived")
  contactOf                  Contact[]             @relation("ContactOfUser")
  contacts                   Contact[]             @relation("UserContacts")
  linkedInAccount            LinkedInAccount?
  linkedInConnections        LinkedInConnection[]
  receivedMessages           Message[]             @relation("MessageReceiver")
  sentMessages               Message[]             @relation("MessageSender")
  sentNotifications          Notification[]        @relation("NotificationSender")
  notifications              Notification[]        @relation("UserNotifications")
  introductionsMade          PendingIntroduction[] @relation("IntroductionsMade")
  introductionsAsPersonA     PendingIntroduction[] @relation("IntroductionsAsPersonA")
  introductionsAsPersonB     PendingIntroduction[] @relation("IntroductionsAsPersonB")
  firstDegreeReferrals       Referral[]            @relation("FirstDegreeContact")
  initiatedReferrals         Referral[]            @relation("ReferralInitiator")
  receivedReferrals          Referral[]            @relation("ReferralRecipient")

  @@index([email])
  @@index([phone])
}

model Contact {
  id            String    @id @default(cuid())
  userId        String
  contactId     String?
  firstName     String
  lastName      String
  email         String?
  phone         String?
  company       String?
  degreeType    String    @default("FIRST_DEGREE")
  requestSentAt DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  contact       User?     @relation("ContactOfUser", fields: [contactId], references: [id])
  user          User      @relation("UserContacts", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([contactId])
}

model Message {
  id           String    @id @default(cuid())
  senderId     String
  receiverId   String
  messageType  String
  subject      String
  body         String
  sentViaEmail Boolean   @default(false)
  sentViaSms   Boolean   @default(false)
  emailSentAt  DateTime?
  smsSentAt    DateTime?
  createdAt    DateTime  @default(now())
  receiver     User      @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  sender       User      @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
}

model Referral {
  id            String    @id @default(cuid())
  refereeId     String
  firstDegreeId String
  referralId    String
  status        String    @default("PENDING")
  customMessage String?
  approvedAt    DateTime?
  deniedAt      DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  firstDegree   User      @relation("FirstDegreeContact", fields: [firstDegreeId], references: [id], onDelete: Cascade)
  referee       User      @relation("ReferralInitiator", fields: [refereeId], references: [id], onDelete: Cascade)
  referral      User      @relation("ReferralRecipient", fields: [referralId], references: [id], onDelete: Cascade)

  @@index([refereeId])
  @@index([firstDegreeId])
  @@index([referralId])
  @@index([status])
}

model BrandingSettings {
  id                    String   @id @default(cuid())
  productName           String   @default("Intro Network")
  desktopSidebarLogo    String?
  desktopHeaderLogo     String?
  footerLogo            String?
  desktopLogo           String?
  mobileLogo            String?
  favicon               String?
  primaryColor          String   @default("#3B82F6")
  secondaryColor        String   @default("#8B5CF6")
  accentColor           String   @default("#EC4899")
  step1Background       String   @default("from-blue-400 via-purple-400 to-pink-400")
  step2Background       String   @default("from-emerald-400 via-teal-400 to-cyan-400")
  step3Background       String   @default("from-orange-400 via-rose-400 to-pink-400")
  step4Background       String   @default("from-violet-400 via-purple-400 to-fuchsia-400")
  flowAStep1Background  String   @default("from-blue-400 via-purple-400 to-pink-400")
  flowAStep2Background  String   @default("from-emerald-400 via-teal-400 to-cyan-400")
  flowAStep3Background  String   @default("from-orange-400 via-rose-400 to-pink-400")
  flowAStep1FormBg      String   @default("white")
  flowAStep2FormBg      String   @default("white")
  flowAStep3FormBg      String   @default("white")
  flowAStep1ButtonBg    String?
  flowAStep2ButtonBg    String?
  flowAStep3ButtonBg    String?
  flowBStep1Background  String   @default("from-blue-400 via-purple-400 to-pink-400")
  flowBStep2Background  String   @default("from-emerald-400 via-teal-400 to-cyan-400")
  flowBStep3Background  String   @default("from-orange-400 via-rose-400 to-pink-400")
  flowBStep4Background  String   @default("from-violet-400 via-purple-400 to-fuchsia-400")
  flowBStep1FormBg      String   @default("white")
  flowBStep2FormBg      String   @default("white")
  flowBStep3FormBg      String   @default("white")
  flowBStep4FormBg      String   @default("white")
  flowBStep1ButtonBg    String?
  flowBStep2ButtonBg    String?
  flowBStep3ButtonBg    String?
  flowBStep4ButtonBg    String?
  flowCStep1Background  String   @default("from-blue-400 via-purple-400 to-pink-400")
  flowCStep2Background  String   @default("from-emerald-400 via-teal-400 to-cyan-400")
  flowCStep3Background  String   @default("from-orange-400 via-rose-400 to-pink-400")
  flowCStep4Background  String   @default("from-violet-400 via-purple-400 to-fuchsia-400")
  flowCStep1FormBg      String   @default("white")
  flowCStep2FormBg      String   @default("white")
  flowCStep3FormBg      String   @default("white")
  flowCStep4FormBg      String   @default("white")
  flowCStep1ButtonBg    String?
  flowCStep2ButtonBg    String?
  flowCStep3ButtonBg    String?
  flowCStep4ButtonBg    String?
  profilePageBackground String   @default("from-blue-400 via-purple-400 to-pink-400")
  profilePageFormBg     String   @default("white")
  flowAStep1Name        String   @default("Your Profile")
  flowAStep2Name        String   @default("Your Network")
  flowAStep3Name        String   @default("Referrals")
  flowAStep4Name        String   @default("Complete")
  flowBStep1Name        String   @default("Review request")
  flowBStep2Name        String   @default("Suggest your contacts")
  flowBStep3Name        String   @default("Review & send")
  flowBStep4Name        String   @default("Track responses")
  flowCStep1Name        String   @default("Review intro")
  flowCStep2Name        String   @default("Accept or decline")
  flowCStep3Name        String   @default("Connect")
  flowCStep4Name        String   @default("Complete")
  step1Name             String   @default("Your Profile")
  step2Name             String   @default("Your Network")
  step3Name             String   @default("Referrals")
  step4Name             String   @default("Complete")
  fontFamily            String   @default("Inter, system-ui, sans-serif")
  headingFont           String   @default("Inter, system-ui, sans-serif")
  customCSS             String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  cardBoxBgSwatches     String   @default("[\"#ffffff\", \"#f9fafb\", \"#fef3c7\", \"#fce7f3\", \"#ecfdf5\", \"#1f2937\"]")
  cardPageBgSwatches    String   @default("[\"#f0f9ff\", \"#fef3c7\", \"#fce7f3\", \"#ecfdf5\", \"#f5f3ff\", \"#fef2f2\"]")
  cardTextSwatches      String   @default("[\"#111827\", \"#374151\", \"#6b7280\", \"#ffffff\", \"#1e40af\", \"#7c3aed\"]")
  appBackground         String   @default("from-blue-50 via-purple-50 to-pink-50")
}

model ApiSettings {
  id                       String   @id @default(cuid())
  emailProvider            String   @default("resend")
  resendApiKey             String?
  resendFromEmail          String?
  gmailEmail               String?
  gmailAppPassword         String?
  sesAccessKeyId           String?
  sesSecretAccessKey       String?
  sesRegion                String?  @default("us-east-1")
  sesFromEmail             String?
  smsEnabled               Boolean  @default(false)
  twilioAccountSid         String?
  twilioAuthToken          String?
  twilioPhoneNumber        String?
  statementSummaryTemplate String?
  anthropicApiKey          String?
  // S3 Storage Configuration
  s3Enabled                Boolean  @default(false)
  s3Bucket                 String?
  s3Region                 String?  @default("us-east-1")
  s3AccessKeyId            String?
  s3SecretAccessKey        String?
  s3PublicUrlPrefix        String?
  // LinkedIn OAuth Configuration
  linkedinEnabled          Boolean  @default(false)
  linkedinClientId         String?
  linkedinClientSecret     String?
  linkedinRedirectUri      String?
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt
  emailFromName            String?
  appUrl                   String?
}

model MessageTemplate {
  id             String   @id @default(cuid())
  templateType   String
  messageChannel String
  subject        String?
  bodyHtml       String?
  bodySms        String?
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([templateType, messageChannel])
  @@index([templateType])
  @@index([messageChannel])
}

model Page {
  id          String    @id @default(cuid())
  title       String
  slug        String    @unique
  isPublished Boolean   @default(false)
  isHomepage  Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  sections    Section[]

  @@index([slug])
  @@index([isPublished])
}

model Section {
  id          String   @id @default(cuid())
  pageId      String
  order       Int
  sectionId   String?
  isFullWidth Boolean  @default(false)
  columns     Int      @default(1)
  content     String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  page        Page     @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@index([pageId])
  @@index([order])
}

model NavigationSettings {
  id          String   @id @default(cuid())
  headerLinks String   @default("[]")
  footerLinks String   @default("[]")
  tagline     String?
  companyName String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model MagicLink {
  id          String    @id @default(cuid())
  token       String    @unique
  userId      String
  redirectUrl String
  expiresAt   DateTime
  used        Boolean   @default(false)
  usedAt      DateTime?
  createdAt   DateTime  @default(now())

  @@index([token])
  @@index([userId])
  @@index([expiresAt])
}

model LinkedInAccount {
  id           String    @id @default(cuid())
  userId       String    @unique
  linkedinId   String    @unique
  accessToken  String
  refreshToken String?
  tokenExpiry  DateTime?
  scope        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([linkedinId])
}

model LinkedInConnection {
  id                String   @id @default(cuid())
  userId            String
  linkedinId        String?
  firstName         String
  lastName          String
  headline          String?
  profilePictureUrl String?
  profileUrl        String?
  lastSyncedAt      DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, linkedinId])
  @@index([userId])
}

model CareerHistory {
  id                   String    @id @default(cuid())
  userId               String
  title                String
  companyName          String
  companyLogoUrl       String?
  location             String?
  description          String?
  startDate            DateTime?
  endDate              DateTime?
  isCurrent            Boolean   @default(false)
  importedFromLinkedIn Boolean   @default(false)
  linkedInPositionId   String?   @unique
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  user                 User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model ConnectionRequest {
  id          String    @id @default(cuid())
  fromUserId  String
  toUserId    String
  note        String?
  status      String    @default("PENDING")
  token       String    @unique @default(cuid())
  respondedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  fromUser    User      @relation("ConnectionRequestsSent", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser      User      @relation("ConnectionRequestsReceived", fields: [toUserId], references: [id], onDelete: Cascade)

  @@unique([fromUserId, toUserId])
  @@index([fromUserId])
  @@index([toUserId])
  @@index([status])
  @@index([token])
}

model Connection {
  id              String   @id @default(cuid())
  userId          String
  connectedUserId String
  createdAt       DateTime @default(now())
  connectedUser   User     @relation("ConnectedToUser", fields: [connectedUserId], references: [id], onDelete: Cascade)
  user            User     @relation("UserConnections", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, connectedUserId])
  @@index([userId])
  @@index([connectedUserId])
}

model Notification {
  id         String    @id @default(cuid())
  userId     String
  type       String
  title      String
  message    String
  link       String?
  isRead     Boolean   @default(false)
  fromUserId String?
  createdAt  DateTime  @default(now())
  readAt     DateTime?
  fromUser   User?     @relation("NotificationSender", fields: [fromUserId], references: [id])
  user       User      @relation("UserNotifications", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, isRead])
  @@index([createdAt])
}

model CardTheme {
  id                   String   @id @default(cuid())
  name                 String
  order                Int      @default(0)
  pageBackground       String
  cardBackground       String
  textColor            String
  profilePictureBorder String
  footerBackground     String
  footerTextColor      String
  buttonABackground    String   @default("#3b82f6")
  buttonATextColor     String   @default("#ffffff")
  buttonBBackground    String   @default("#10b981")
  buttonBTextColor     String   @default("#ffffff")
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@index([order])
}

model PendingIntroduction {
  id               String    @id @default(cuid())
  introducerId     String
  personAUserId    String?
  personAEmail     String
  personAName      String
  personACompany   String?
  personAContext   String?
  personBUserId    String?
  personBEmail     String
  personBName      String
  personBCompany   String?
  personBContext   String?
  message          String
  status           String    @default("pending")
  personAAccepted  Boolean   @default(false)
  personBAccepted  Boolean   @default(false)
  personAEmailSent Boolean   @default(false)
  personBEmailSent Boolean   @default(false)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  acceptedAt       DateTime?
  introducer       User      @relation("IntroductionsMade", fields: [introducerId], references: [id], onDelete: Cascade)
  personAUser      User?     @relation("IntroductionsAsPersonA", fields: [personAUserId], references: [id])
  personBUser      User?     @relation("IntroductionsAsPersonB", fields: [personBUserId], references: [id])

  @@index([introducerId])
  @@index([personAUserId])
  @@index([personBUserId])
  @@index([personAEmail])
  @@index([personBEmail])
  @@index([status])
}
